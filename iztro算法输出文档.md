# iztro 紫微斗数算法输出文档

## 概述
iztro 是一个开源的紫微斗数排盘算法库，使用 TypeScript 编写。该库能够根据出生日期时间和性别，计算并输出完整的紫微斗数星盘数据。

## 核心数据结构

### 1. Astrolabe（星盘对象）
星盘是最顶层的数据结构，包含了所有的排盘信息。

#### 基本信息字段：
- `gender`: 性别
- `solarDate`: 阳历日期
- `lunarDate`: 农历日期  
- `chineseDate`: 干支纪年日期
- `time`: 时辰
- `timeRange`: 时辰对应的时间段
- `sign`: 星座
- `zodiac`: 生肖
- `earthlyBranchOfSoulPalace`: 命宫地支
- `earthlyBranchOfBodyPalace`: 身宫地支
- `soul`: 命主
- `body`: 身主
- `fiveElementsClass`: 五行局
- `palaces`: 十二宫数据数组

### 2. Palace（宫位对象）
每个宫位包含以下信息：

#### 基本属性：
- `index`: 宫位索引（0-11）
- `name`: 宫位名称（命宫、兄弟、夫妻、子女、财帛、疾厄、迁移、交友、官禄、田宅、福德、父母）
- `isBodyPalace`: 是否身宫
- `isOriginalPalace`: 是否来因宫
- `heavenlyStem`: 宫位天干
- `earthlyBranch`: 宫位地支

#### 星曜数组（每个宫位都包含）：
- `majorStars`: 主星数组
- `minorStars`: 辅星数组
- `adjectiveStars`: 杂曜数组
- `changsheng12`: 长生十二神
- `boshi12`: 博士十二神
- `jiangqian12`: 将前十二神（流年）
- `suiqian12`: 岁前十二神（流年）

#### 运限信息：
- `decadal`: 大限（包含起止年龄）
- `ages`: 小限年龄数组

### 3. 星曜类型分类

#### 十四主星（majorStars）：
- 紫微、天机、太阳、武曲、天同、廉贞
- 天府、太阴、贪狼、巨门、天相、天梁、七杀、破军

#### 辅星（minorStars）：
- 六吉星：文昌、文曲、天魁、天钺、左辅、右弼
- 六煞星：擎羊、陀罗、火星、铃星、地劫、地空
- 四化星：化禄、化权、化科、化忌

#### 杂曜（adjectiveStars）：
- 天马、天喜、红鸾、天姚、咸池
- 孤辰、寡宿、破碎、天哭、天虚
- 龙池、凤阁、台辅、封诰、天官、天福
- 天贵、恩光、天厨、天寿、天才、天月
- 阴煞、天巫、解神、天德、月德

#### 神煞系统：
- 长生十二神：长生、沐浴、冠带、临官、帝旺、衰、病、死、墓、绝、胎、养
- 博士十二神：博士、力士、青龙、小耗、将军、奏书、飞廉、喜神、病符、大耗、伏兵、官府
- 将前十二神：将星、攀鞍、岁驿、息神、华盖、劫煞、灾煞、天煞、指背、咸池、月煞、亡神
- 岁前十二神：岁建、晦气、丧门、贯索、官符、小耗、大耗、龙德、白虎、天德、吊客、病符

### 4. Horoscope（运限对象）
运限系统包含多个层级：

#### 运限类型：
- `decadal`: 大限（10年运）
- `age`: 小限（年运）  
- `yearly`: 流年
- `monthly`: 流月
- `daily`: 流日
- `hourly`: 流时

#### 每个运限包含：
- `index`: 所在宫位索引
- `name`: 运限名称
- `heavenlyStem`: 运限天干
- `earthlyBranch`: 运限地支
- `palaceNames`: 该运限的十二宫
- `mutagen`: 四化星
- `stars`: 流耀（流年星、流月星等）

### 5. 特殊字段说明

#### 四化系统：
根据天干决定四化星的分配，每个天干对应不同的星曜化禄、化权、化科、化忌。

#### 星曜亮度：
每颗星在不同宫位有不同的亮度等级：
- `wang`（旺）: 最亮
- `miao`（庙）: 次亮
- `de`（得）: 正常
- `li`（利）: 稍弱
- `ping`（平）: 平常
- `bu`（不）: 不得地
- `xian`（陷）: 落陷

## JSON 输出结构示例

```json
{
  "gender": "男",
  "solarDate": "2025-01-01",
  "lunarDate": "腊月初二",
  "palaces": [
    {
      "index": 0,
      "name": "命宫",
      "heavenlyStem": "甲",
      "earthlyBranch": "子",
      "majorStars": [
        {"name": "紫微", "brightness": "旺", "type": "主星"}
      ],
      "minorStars": [
        {"name": "文昌", "type": "吉星"},
        {"name": "天魁", "type": "贵人"}
      ],
      "adjectiveStars": [
        {"name": "天喜", "type": "桃花"},
        {"name": "天马", "type": "驿马"}
      ],
      "changsheng12": "长生",
      "boshi12": "博士",
      "jiangqian12": "将星",
      "suiqian12": "岁建",
      "decadal": {
        "range": [25, 34],
        "heavenlyStem": "丙",
        "earthlyBranch": "寅"
      },
      "ages": [1, 13, 25, 37, 49, 61, 73, 85, 97]
    }
    // ... 其他11个宫位
  ]
}
```

## 使用说明

1. **完整性**：算法会计算并输出所有传统紫微斗数所需的星曜和神煞。

2. **准确性**：遵循传统紫微斗数的排盘规则，支持多种流派的差异化配置。

3. **扩展性**：支持通过配置项调整四化、星曜亮度等规则。

4. **多语言**：支持中文简体、繁体、英文、日文、韩文、越南文等多种语言输出。

## 重要提示

在 iOS 应用中显示时，需要确保：
1. 遍历所有字段提取星曜数据
2. 处理嵌套的数据结构（如 decadal.stars）
3. 正确映射字段名到显示名称
4. 根据星曜类型和名称设置合适的颜色

---
文档更新日期：2025-09-09