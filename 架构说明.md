# 紫微斗数 iOS 应用架构

## 核心设计理念
- **算法封装**：只使用 iztro 开源库的核心计算功能
- **UI独立**：完全自主设计的中国传统风格界面
- **交互优化**：针对移动端优化的用户体验

## 架构分层

### 1. 算法层（封装开源库）
- `iztro.min.js`：原始的 iztro 算法库
- `iztro-final.html`：JavaScript 封装层
  - 处理 WebView 兼容性问题
  - 提供错误处理和降级方案
  - 只暴露核心计算接口

### 2. 桥接层
- `IztroManager.swift`：iOS 与 JavaScript 的桥接
  - 管理 WebView 生命周期
  - 处理数据传输
  - 提供状态管理

### 3. UI层（完全自主设计）
- `ZiWeiContentView.swift`：主界面
  - 传统紫微斗数风格设计
  - 紫色主题配色
  - 专业的输入表单

- `ZiWeiChartView`：星盘展示
  - 传统十二宫格布局
  - 交互式宫位选择
  - 详细的星耀信息展示

## 核心功能

### 输入
- 性别选择（男/女）
- 日期选择（公历/农历）
- 时间选择（精确到分钟）
- 出生地输入

### 计算（使用 iztro）
- 将输入转换为 iztro 格式
- 调用 `iztro.astro.bySolar()` 计算
- 处理返回的星盘数据

### 输出
- 十二宫位展示
- 主星、辅星分类显示
- 命宫、身宫标记
- 五行局等基础信息

## 技术特点

1. **混合开发**：结合 SwiftUI 原生界面和 JavaScript 算法
2. **错误处理**：当算法失败时提供测试数据
3. **响应式设计**：适配不同尺寸的 iOS 设备
4. **性能优化**：WebView 预加载，计算异步处理

## 文件清单

### 必需文件
- `ZiWeiContentView.swift` - 主界面
- `IztroManager.swift` - 桥接管理器
- `iztro-final.html` - JavaScript 封装
- `iztro.min.js` - 核心算法库
- `PurpleMApp.swift` - 应用入口

### 可选文件（旧版本，可删除）
- `ContentView.swift`
- `IztroWebView.swift`
- `iztro-simple.html`
- `iztro-working.html`
- `test.html`

## 部署步骤

1. 在 Xcode 中添加所有必需文件
2. 确保 HTML 和 JS 文件在 Copy Bundle Resources 中
3. Clean Build Folder
4. 运行应用

## 注意事项

- 如果 iztro 算法调用失败，会返回测试数据以保证 UI 正常显示
- 可以通过修改 `iztro-final.html` 调整算法调用方式
- UI 完全独立于算法，可以自由修改设计